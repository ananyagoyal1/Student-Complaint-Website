<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Complaints Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.prod.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <style>
        /* ... (previous CSS remains the same) ... */
    </style>
</head>
<body>
    <div id="app" class="container">
        <h1>Student Complaints Portal</h1>
        
        <form @submit.prevent="submitComplaint">
            <label for="name">Name:</label>
            <input type="text" id="name" v-model="newComplaint.name" required>
            
            <label for="room">Room Number:</label>
            <input type="text" id="room" v-model="newComplaint.room" required>
            
            <label for="category">Category:</label>
            <input type="text" id="category" v-model="newComplaint.category" required>
            
            <label for="description">Description:</label>
            <textarea id="description" v-model="newComplaint.description" required></textarea>
            
            <button type="submit">Submit Complaint</button>
        </form>
        
        <div class="complaints">
            <h2>Recent Complaints</h2>
            <div v-for="complaint in complaints" :key="complaint.id" class="complaint">
                <h3>{{ complaint.category }}</h3>
                <p><strong>Name:</strong> {{ complaint.name }}</p>
                <p><strong>Room:</strong> {{ complaint.room }}</p>
                <p><strong>Description:</strong> {{ complaint.description }}</p>
                <p><strong>Date:</strong> {{ formatDate(complaint.date) }}</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAp8VUklsO1dftVBALVLdfXThBNMF23XvE",
            authDomain: "student-complaint-website.firebaseapp.com",
            databaseURL: "https://student-complaint-website.firebaseio.com",
            projectId: "student-complaint-website",
            storageBucket: "student-complaint-website.appspot.com",
            messagingSenderId: "122485188859",
            appId: "1:122485188859:web:dbba35862647376c19e85e",
            measurementId: "G-EMS47VZGE6"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const database = getDatabase(app);

        const { createApp, ref: vueRef, onMounted } = Vue;

        createApp({
            setup() {
                const complaints = vueRef([]);
                const newComplaint = vueRef({
                    name: '',
                    room: '',
                    category: '',
                    description: ''
                });

                const submitComplaint = () => {
                    const complaint = {
                        ...newComplaint.value,
                        id: Date.now(),
                        date: new Date().toISOString()
                    };
                    push(ref(database, 'complaints'), complaint);
                    newComplaint.value = {
                        name: '',
                        room: '',
                        category: '',
                        description: ''
                    };
                };

                const formatDate = (dateString) => {
                    return moment(dateString).format('MMMM Do YYYY, h:mm:ss a');
                };

                onMounted(() => {
                    const complaintsRef = ref(database, 'complaints');
                    onValue(complaintsRef, (snapshot) => {
                        const data = snapshot.val();
                        const complaintsArray = [];
                        for (let id in data) {
                            complaintsArray.push({ id, ...data[id] });
                        }
                        complaints.value = complaintsArray.sort((a, b) => b.date.localeCompare(a.date));
                    });
                });

                return {
                    complaints,
                    newComplaint,
                    submitComplaint,
                    formatDate
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
